<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill of Rights — Panodime</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-bg: #0a0a0f;
            --color-surface: #12121a;
            --color-surface-elevated: #1a1a25;
            --color-primary: #6366f1;
            --color-primary-glow: rgba(99, 102, 241, 0.3);
            --color-accent: #22d3ee;
            --color-accent-warm: #f472b6;
            --color-text: #f4f4f5;
            --color-text-muted: #a1a1aa;
            --color-border: rgba(255, 255, 255, 0.08);
            --font-display: 'Instrument Serif', Georgia, serif;
            --font-body: 'DM Sans', system-ui, sans-serif;
            --ease-out-expo: cubic-bezier(0.16, 1, 0.3, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            background: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            overflow: hidden;
        }

        .bg-gradient::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(ellipse 80% 50% at 20% 40%, rgba(99, 102, 241, 0.15), transparent),
                radial-gradient(ellipse 60% 40% at 80% 60%, rgba(244, 114, 182, 0.1), transparent);
            animation: bgFloat 20s ease-in-out infinite;
        }

        @keyframes bgFloat {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(-2%, 2%) rotate(1deg); }
            66% { transform: translate(2%, -1%) rotate(-1deg); }
        }

        .noise {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            opacity: 0.03;
            pointer-events: none;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(12px);
            background: rgba(10, 10, 15, 0.7);
            border-bottom: 1px solid var(--color-border);
        }

        .logo {
            font-family: var(--font-display);
            font-size: 1.75rem;
            font-weight: 400;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, var(--color-text) 0%, var(--color-accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-decoration: none;
        }

        .nav-links {
            display: flex;
            gap: 2.5rem;
            list-style: none;
        }

        .nav-links a {
            color: var(--color-text-muted);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            transition: color 0.2s ease;
            position: relative;
        }

        .nav-links a.active {
            color: var(--color-text);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--color-primary);
            transition: width 0.3s var(--ease-out-expo);
        }

        .nav-links a.active::after,
        .nav-links a:hover::after {
            width: 100%;
        }

        .nav-links a:hover {
            color: var(--color-text);
        }

        .nav-cta {
            padding: 0.75rem 1.5rem;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 100px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
            text-decoration: none;
        }

        .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--color-primary-glow);
        }

        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            gap: 5px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
        }

        .mobile-menu-btn span {
            display: block;
            width: 24px;
            height: 2px;
            background: var(--color-text);
        }

        /* Page Header */
        .page-header {
            padding: 10rem 2rem 4rem;
            text-align: center;
            position: relative;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(to bottom, var(--color-surface), transparent);
            z-index: -1;
        }

        .page-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 100px;
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-bottom: 1.5rem;
            animation: fadeSlideUp 0.8s var(--ease-out-expo) 0.1s both;
        }

           .page-header h1 {
            font-family: var(--font-display);
            font-size: clamp(2.5rem, 8vw, 5rem);
            font-weight: 400;
            line-height: 1.3;  /* ADD THIS LINE HERE */
            letter-spacing: -0.03em;
            margin-bottom: 1.5rem;
            animation: fadeSlideUp 0.8s var(--ease-out-expo) 0.2s both;
        }

        .page-header h1 em {
            font-style: italic;
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-subtitle {
            font-size: 1.25rem;
            color: var(--color-text-muted);
            max-width: 650px;
            margin: 0 auto;
            animation: fadeSlideUp 0.8s var(--ease-out-expo) 0.3s both;
        }

        @keyframes fadeSlideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Rights Section */
        .rights-section {
            padding: 4rem 2rem 8rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .preamble {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 24px;
            padding: 3rem;
            margin-bottom: 4rem;
            position: relative;
            overflow: hidden;
        }

        .preamble::before {
            content: '"';
            font-family: var(--font-display);
            font-size: 12rem;
            position: absolute;
            top: -2rem;
            left: 1rem;
            color: var(--color-primary);
            opacity: 0.1;
            line-height: 1;
        }

        .preamble p {
            font-size: 1.25rem;
            color: var(--color-text-muted);
            line-height: 1.8;
            position: relative;
            z-index: 1;
        }

        .rights-list {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .right-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 20px;
            padding: 2.5rem;
            display: grid;
            grid-template-columns: 80px 1fr;
            gap: 2rem;
            align-items: start;
            transition: all 0.4s var(--ease-out-expo);
            opacity: 0;
            transform: translateY(30px);
        }

        .right-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .right-card:hover {
            border-color: var(--color-primary);
            transform: translateX(8px);
            box-shadow: -20px 0 60px rgba(99, 102, 241, 0.1);
        }

        .right-number {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-accent));
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 400;
            flex-shrink: 0;
        }

        .right-content h3 {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 400;
            margin-bottom: 0.75rem;
        }

        .right-content p {
            color: var(--color-text-muted);
            font-size: 1rem;
            line-height: 1.7;
        }

        /* CTA */
        .page-cta {
            text-align: center;
            padding: 4rem 2rem 8rem;
        }

        .cta-box {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 24px;
            padding: 4rem;
            max-width: 700px;
            margin: 0 auto;
        }

        .cta-box h2 {
            font-family: var(--font-display);
            font-size: 2rem;
            font-weight: 400;
            margin-bottom: 1rem;
        }

        .cta-box p {
            color: var(--color-text-muted);
            margin-bottom: 2rem;
        }

        .btn-primary {
            padding: 1rem 2rem;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 100px;
            font-family: var(--font-body);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s var(--ease-out-expo);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 40px var(--color-primary-glow);
        }

        /* Footer */
        footer {
            border-top: 1px solid var(--color-border);
            padding: 3rem 2rem;
            text-align: center;
        }

        footer p {
            color: var(--color-text-muted);
            font-size: 0.9rem;
        }

        footer a {
            color: var(--color-text);
            text-decoration: none;
        }

        footer a:hover {
            color: var(--color-primary);
        }

        @media (max-width: 768px) {
            nav {
                padding: 1rem 1.5rem;
            }

            .nav-links {
                display: none;
                flex-direction: column;
                position: absolute;
                top: 100%;
                 left: 0;
                right: 0;
                background: rgba(10, 10, 15, 0.95);
                backdrop-filter: blur(12px);
                padding: 1rem;
                border-bottom: 1px solid var(--color-border);
            }

            .mobile-menu-btn {
                display: flex;
            }

            .page-header {
                padding: 8rem 1.5rem 3rem;
            }

            .rights-section {
                padding: 2rem 1.5rem 6rem;
            }

            .preamble {
                padding: 2rem;
            }

            .right-card {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .right-number {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }

            .cta-box {
                padding: 2.5rem 1.5rem;
            }
        }

        /* Comments Section Styles */
        .comments-section {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--color-border);
        }

        .comments-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--color-text);
            margin-bottom: 1.5rem;
        }

        .comment-form {
            margin-bottom: 2rem;
        }

        .comment-input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            color: var(--color-text);
            font-family: var(--font-body);
            font-size: 0.9rem;
            transition: border-color 0.2s ease;
        }

        .comment-input:focus {
            outline: none;
            border-color: var(--color-primary);
        }

        .comment-input::placeholder {
            color: var(--color-text-muted);
        }

        textarea.comment-input {
            min-height: 100px;
            resize: vertical;
        }

        .comment-submit {
            padding: 0.75rem 1.5rem;
            background: var(--color-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .comment-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px var(--color-primary-glow);
        }

        .comment-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .comment {
            padding: 1rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 8px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .comment-author {
            color: var(--color-text);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .comment-time {
            color: var(--color-text-muted);
            font-size: 0.8rem;
        }

        .comment-text {
            color: var(--color-text);
            font-size: 0.9rem;
            line-height: 1.6;
            margin: 0;
        }

        .no-comments {
            color: var(--color-text-muted);
            font-size: 0.9rem;
            text-align: center;
            padding: 2rem;
            font-style: italic;
        }

        /* Comment Bubble Icon */
        .comment-trigger {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            background: transparent;
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
            border-radius: 100px;
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .comment-trigger:hover {
            background: var(--color-surface);
            color: var(--color-text);
            border-color: var(--color-primary);
        }

        .comment-trigger svg {
            width: 20px;
            height: 20px;
        }

        .comment-count {
            font-weight: 600;
        }

        /* Username Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: var(--color-surface-elevated);
            padding: 2.5rem;
            border-radius: 16px;
            border: 1px solid var(--color-border);
            max-width: 440px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-content h3 {
            font-family: var(--font-display);
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            color: var(--color-text);
            text-align: center;
        }

        .modal-content > p {
            color: var(--color-text-muted);
            margin-bottom: 2rem;
            font-size: 0.95rem;
            text-align: center;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: transparent;
            border: none;
            color: var(--color-text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--color-surface);
            color: var(--color-text);
        }

        .username-requirements {
            background: var(--color-surface);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-size: 0.85rem;
            color: var(--color-text-muted);
        }

        .username-requirements ul {
            margin: 0.5rem 0 0 1.2rem;
        }

        /* Auth Buttons */
        .auth-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .auth-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            background: var(--color-surface);
            color: var(--color-text);
            border: 1px solid var(--color-border);
            border-radius: 8px;
            font-family: var(--font-body);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .auth-button:hover {
            background: var(--color-surface-elevated);
            border-color: var(--color-primary);
            transform: translateY(-2px);
        }

        .auth-button.google {
            background: white;
            color: #444;
        }

        .auth-button.google:hover {
            background: #f8f9fa;
        }

        .auth-button.primary {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .auth-button.primary:hover {
            box-shadow: 0 8px 20px var(--color-primary-glow);
        }

        .auth-divider {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
            color: var(--color-text-muted);
            font-size: 0.85rem;
        }

        .auth-divider::before,
        .auth-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--color-border);
        }

        /* Email Form */
        .email-auth-form {
            display: none;
        }

        .email-auth-form.active {
            display: block;
        }

        .form-toggle {
            text-align: center;
            margin-top: 1rem;
            font-size: 0.9rem;
            color: var(--color-text-muted);
        }

        .form-toggle button {
            background: none;
            border: none;
            color: var(--color-primary);
            cursor: pointer;
            text-decoration: underline;
            font-weight: 600;
        }

        .form-toggle button:hover {
            color: var(--color-accent);
        }

        .sign-in-prompt {
            display: none;
        }

        .comment-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .delete-comment-btn {
            padding: 0.25rem 0.75rem;
            background: transparent;
            color: var(--color-text-muted);
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .delete-comment-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
            border-color: #ef4444;
        }

        .user-info {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: 100px;
            font-size: 0.85rem;
            color: var(--color-text);
            margin-bottom: 1rem;
        }

        .user-info .username {
            font-weight: 600;
        }

        .sign-out-btn {
            background: none;
            border: none;
            color: var(--color-text-muted);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .sign-out-btn:hover {
            background: var(--color-surface-elevated);
            color: var(--color-text);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #ef4444;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .sign-in-to-comment-prompt {
    padding: 1rem;
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    text-align: center;
    margin-bottom: 1rem;
        
        }

.sign-in-to-comment-prompt p {
    color: var(--color-text-muted);
    font-size: 0.9rem;
    margin: 0;
        
        }

.sign-in-to-comment-prompt a {
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 600;

        }

.sign-in-to-comment-prompt a:hover {
    color: var(--color-accent);

    }

    /* Nested Comments / Replies */
    .comment-replies {
        margin-left: 2rem;
        margin-top: 1rem;
        padding-left: 1rem;
        border-left: 2px solid var(--color-border);
    }

    .comment.reply {
        margin-bottom: 1rem;
    }

    .reply-button {
        padding: 0.25rem 0.75rem;
        background: transparent;
        color: var(--color-primary);
        border: 1px solid var(--color-border);
        border-radius: 4px;
        font-size: 0.75rem;
        cursor: pointer;
        transition: all 0.2s ease;
        margin-left: 0.5rem;
    }

    .reply-button:hover {
        background: var(--color-surface);
        border-color: var(--color-primary);
    }

    .reply-form {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--color-surface);
        border-radius: 8px;
        border: 1px solid var(--color-border);
        display: none;
    }

    .reply-form.active {
        display: block;
    }

    .reply-to-indicator {
        font-size: 0.85rem;
        color: var(--color-text-muted);
        margin-bottom: 0.5rem;
    }

    .reply-to-indicator strong {
        color: var(--color-primary);
    }

    .cancel-reply-btn {
        padding: 0.5rem 1rem;
        background: transparent;
        color: var(--color-text-muted);
        border: 1px solid var(--color-border);
        border-radius: 6px;
        font-size: 0.85rem;
        cursor: pointer;
        margin-left: 0.5rem;
    }

    .cancel-reply-btn:hover {
        background: var(--color-surface);
        color: var(--color-text);
    }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    <div class="noise"></div>

    <nav>
        <a href="index.html" class="logo">Panodime</a>
        <ul class="nav-links">
            <li><a href="our-story-and-mission.html">Our Story and Mission</a></li>
            <li><a href="bill-of-rights.html" class="active">Our AI Era Bill of Rights</a></li>
        </ul>
        <!-- <a href="index.html#join" class="nav-cta">Join the Movement</a> -->
        <button class="mobile-menu-btn" aria-label="Menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
    </nav>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeAuthModal()">×</button>
            <h3>Sign in to Comment</h3>
            <p>Join the conversation and share your thoughts</p>
            
            <div id="error-message" class="error-message"></div>
            
            <div class="auth-options">
                <button class="auth-button google" onclick="handleGoogleSignIn()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continue with Google
                </button>
                
                <div class="auth-divider">or</div>
                
                <button class="auth-button" onclick="showEmailAuth('signin')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
                        <polyline points="22,6 12,13 2,6"/>
                    </svg>
                    Sign in with Email
                </button>
            </div>
            
            <!-- Email Sign In Form -->
            <div id="email-signin-form" class="email-auth-form">
                <input type="email" id="signin-email" class="comment-input" placeholder="Email address">
                <input type="password" id="signin-password" class="comment-input" placeholder="Password">
                <button class="auth-button primary" onclick="handleEmailSignIn()">Sign In</button>
                <div class="form-toggle">
                    Don't have an account? <button onclick="showEmailAuth('signup')">Sign up</button>
                </div>
            </div>
            
            <!-- Email Sign Up Form -->
            <div id="email-signup-form" class="email-auth-form">
                <input type="email" id="signup-email" class="comment-input" placeholder="Email address">
                <input type="password" id="signup-password" class="comment-input" placeholder="Password (min 6 characters)">
                <button class="auth-button primary" onclick="handleEmailSignUp()">Create Account</button>
                <div class="form-toggle">
                    Already have an account? <button onclick="showEmailAuth('signin')">Sign in</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Username Creation Modal -->
    <div id="username-modal" class="modal">
        <div class="modal-content">
            <h3>Choose Your Username</h3>
            <p>This username will be displayed on all your comments.</p>
            <div class="username-requirements">
                <strong>Requirements:</strong>
                <ul>
                    <li>3-20 characters</li>
                    <li>Letters, numbers, and underscores only</li>
                    <li>Cannot be changed later</li>
                </ul>
            </div>
            <input type="text" id="username-input" class="comment-input" placeholder="Enter username" maxlength="20">
            <button class="auth-button primary" onclick="createUsername()">Create Username</button>
        </div>
    </div>

    <header class="page-header">
        <div class="page-badge">The Foundation of the Society We Will Build Together</div>
        <h1>Our AI Era <em>Bill Of Rights<span style="font-size: 14px; vertical-align: super;">TM</span></em></h1>
        <p class="page-subtitle">These rights exist beyond politics or any of the lines we draw to divide ourselves. They are designed to be an expression of universal truths worth living for. Their spirit will guide our efforts to use AI to bring about an era of human prosperity and flourishing like we've never seen.</p>
    </header>

    <section class="rights-section">
        <div class="container">

            <div class="rights-list">
                <article class="right-card">
                    <div class="right-number">I</div>
                    <div class="right-content">
                        <h3>Human Dignity</h3>
                        <p>AI must exist only to enhance human autonomy and freedom, and must never undermine human dignity. It should never be used to manipulate human behavior, but instead should enhance people's ability to decide for themselves and author their own stories.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="1">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-1" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-1" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-1" class="comment-submit" onclick="submitComment(1)">Post Comment</button>
                                </div>
                                <div id="comments-list-1" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">II</div>
                    <div class="right-content">
                        <h3>Economic Security</h3>
                        <p>AI will inevitably cause unprecedented levels of job loss, and workers who are replaced by AI should have access to meaningful support, including special compensation ("AI Replacement Income" or AIRI) for being replaced that reflects the challenge of transition to new opportunities and the availability of those opportunities. In other words, replaced workers should be compensated in proportion to the degree AI shrinks the overall job market and their ability to access a dramatically altered job market.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="2">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-2" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-2" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-2" class="comment-submit" onclick="submitComment(2)">Post Comment</button>
                                </div>
                                <div id="comments-list-2" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">III</div>
                    <div class="right-content">
                        <h3>Universal Access</h3>
                        <p>AI's benefits must be accessible to all people, regardless of economic status. Public AI infrastructure must be developed to ensure that people are not left behind in accessing AI-powered services and opportunities.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="3">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-3" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-3" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-3" class="comment-submit" onclick="submitComment(3)">Post Comment</button>
                                </div>
                                <div id="comments-list-3" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">IV</div>
                    <div class="right-content">
                        <h3>Human Governance</h3>
                        <p>AI systems and development must be governed collectively, in that the priorities must be specially established by the people collectively and should not be guided merely by elite, special interests. AI should be subject to a special regulatory regime, with checks and balances and power over the future of AI distributed among various stakeholders in society.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="4">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-4" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-4" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-4" class="comment-submit" onclick="submitComment(4)">Post Comment</button>
                                </div>
                                <div id="comments-list-4" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">V</div>
                    <div class="right-content">
                        <h3>Transparency</h3>
                        <p>AI products must be clearly marked with transparent indicators that give every person the ability to know when they are interacting with AI, how it creates its content, and what data it uses. The creators of AI systems and products must be able provide full, transparent, and overarching explanations of their creations.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="5">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-5" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-5" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-5" class="comment-submit" onclick="submitComment(5)">Post Comment</button>
                                </div>
                                <div id="comments-list-5" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">VI</div>
                    <div class="right-content">
                        <h3>Free Speech and Expression</h3>
                        <p>AI systems must also promote free speech and expression, protecting human diversity of opinion and ensuring non-discrimination against belief systems as established in the US Constitution and more broadly in enlightenment principles.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="6">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-6" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-6" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-6" class="comment-submit" onclick="submitComment(6)">Post Comment</button>
                                </div>
                                <div id="comments-list-6" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">VII</div>
                    <div class="right-content">
                        <h3>Non-Discrimination</h3>
                        <p>AI systems must not perpetuate or amplify discrimination based on race, gender, age, disability, religion, belief-systems, sexual orientation, or any other protected characteristic and must provide equal protection to all people regardless of any characteristic. Regular audits must ensure these protections are adequately in place.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="7">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-7" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-7" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-7" class="comment-submit" onclick="submitComment(7)">Post Comment</button>
                                </div>
                                <div id="comments-list-7" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">VIII</div>
                    <div class="right-content">
                        <h3>Privacy</h3>
                        <p>AI systems may only collect data in line with robust, modern privacy standards, including only collecting from people with their informed consent. Data must always be protected from unauthorized access and kept fully private. Individuals must always have the right to access, correct, delete, and alter permissions on what data they share with AI.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="8">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-8" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-8" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-8" class="comment-submit" onclick="submitComment(8)">Post Comment</button>
                                </div>
                                <div id="comments-list-8" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">IX</div>
                    <div class="right-content">
                        <h3>Safety</h3>
                        <p>AI systems must be specially regulated by a collective of elected experts and policymakers to ensure they do not cause harm to individuals or society. Mechanisms should be in place to enforce economic accountability and, in the cases of depraved heart or malice, criminal accountability, especially with those that are developing frontier AI products.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="9">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-9" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-9" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-9" class="comment-submit" onclick="submitComment(9)">Post Comment</button>
                                </div>
                                <div id="comments-list-9" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>

                <article class="right-card">
                    <div class="right-number">X</div>
                    <div class="right-content">
                        <h3>Peaceful Coexistence with AGI</h3>
                        <p>If and when AGI (Artificial General Intelligence) is created, it likely will be conscious, sentient, and capable of making decisions, essentially becoming a species of its own. Such a species must be created if and only if it will always respect human dignity and rights. Humans also should exist peacefully with this new species of AGI and extend it reasonable rights and protections based upon its faculties, reserving the right to shut it down if it violates fundamental human rights.</p>
                        
                        <div class="comments-section">
                            <button class="comment-trigger" data-right="10">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                </svg>
                                <span class="comment-count">0</span> Comments
                            </button>
                            
                            <div id="comment-section-10" style="display: none;">
                                <div class="user-info" style="display: none;"></div>
                                <div class="comment-form" style="display: none;">
                                    <textarea id="comment-text-10" class="comment-input" placeholder="Share your thoughts..." maxlength="500"></textarea>
                                    <button id="comment-submit-10" class="comment-submit" onclick="submitComment(10)">Post Comment</button>
                                </div>
                                <div id="comments-list-10" class="comments-list"></div>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
        </div>
    </section>

    <section class="page-cta">
        <div class="cta-box">
            <h2>The Solution is You. Stand with us.</h2>
            <p>Together we can ensure these rights will define the AI Era as we use AI to create the world we deserve.</p>  
                <p>This AI Bill of Rights is meant to be a product of our collective will and insight, so you can start being part of the solution by leaving your comments above. And stay tuned, because we are just getting started and will have ways you can take action soon.</p>
            <!-- <a href="index.html#join" class="btn-primary">
                Join the Movement
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 12h14M12 5l7 7-7 7"/>
                </svg>
            </a> -->
        </div>
    </section>

    <footer>
        <p>© 2025 Panodime. All rights reserved. <a href="index.html">Return to Home</a></p>
    </footer>

    <script type="module">
  // Import the functions you need from the SDKs you need
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, setDoc, getDoc, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
  import { getAuth, signInWithPopup, GoogleAuthProvider, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
  // TODO: Add SDKs for Firebase products that you want to use
  // https://firebase.google.com/docs/web/setup#available-libraries

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyCRnBA00Poq-7premOIN-TbevzhCMJYCh8",
    authDomain: "panodime-bill-of-rights-signin.firebaseapp.com",
    projectId: "panodime-bill-of-rights-signin",
    storageBucket: "panodime-bill-of-rights-signin.firebasestorage.app",
    messagingSenderId: "456331010452",
    appId: "1:456331010452:web:e411f786c4dab2c351ef81",
    measurementId: "G-LB5239SCLV"
  };


        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const googleProvider = new GoogleAuthProvider();

        let currentUser = null;
        let currentUsername = null;
        let commentCounts = {};

        // Monitor auth state
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                // Check if user has a username
                const userDoc = await getDoc(doc(db, 'users', user.uid));
                if (userDoc.exists()) {
                    currentUsername = userDoc.data().username;
                    updateAuthUI(true, currentUsername);
                } else {
                    // Show username creation modal
                    showUsernameModal();
                }
            } else {
                currentUser = null;
                currentUsername = null;
                updateAuthUI(false);
            }
        });

   // Update UI based on auth state
function updateAuthUI(isSignedIn, username = null) {
    const commentTriggers = document.querySelectorAll('.comment-trigger');
    const commentForms = document.querySelectorAll('.comment-form');
    const userInfos = document.querySelectorAll('.user-info');
    
    // Comment triggers should work for everyone - just toggle visibility
    commentTriggers.forEach((trigger, index) => {
        const rightNum = index + 1;
        const count = commentCounts[rightNum] || 0;
        trigger.onclick = () => {
            toggleCommentSection(rightNum);
        };
    });

    // Show comment form always, but make textarea trigger login if not signed in
    commentForms.forEach((form, index) => {
        const rightNum = index + 1;
        const textarea = form.querySelector('textarea');
    
        if (isSignedIn) {
            form.style.display = 'block';
            if (textarea) textarea.onclick = null;
        } else {
            form.style.display = 'block'; // Show form but make it trigger login
            if (textarea) {
                textarea.onclick = function(e) {
                    e.preventDefault();
                    showAuthModal();
                    this.blur();
                };
                textarea.style.cursor = 'pointer';
            }
        }
    });

    userInfos.forEach(info => {
        if (isSignedIn) {
            info.innerHTML = `
                <span class="username">${escapeHtml(username)}</span>
                <button class="sign-out-btn" onclick="handleSignOut()">Sign out</button>
            `;
            info.style.display = 'inline-flex';
        } else {
            info.style.display = 'none';
        }
    });
    
    // Show sign-in prompt when not logged in
    document.querySelectorAll('.comment-section-wrapper').forEach((wrapper, index) => {
        const rightNum = index + 1;
        const section = document.getElementById(`comment-section-${rightNum}`);
        if (!isSignedIn && section) {
            // Add sign-in prompt if it doesn't exist
            let prompt = section.querySelector('.sign-in-to-comment-prompt');
            if (!prompt) {
                prompt = document.createElement('div');
                prompt.className = 'sign-in-to-comment-prompt';
                prompt.innerHTML = '<p>Please <a href="#" onclick="showAuthModal(); return false;">sign in</a> to leave a comment</p>';
                section.insertBefore(prompt, section.querySelector('.comment-form'));
            }
            prompt.style.display = 'block';
        } else if (section) {
            const prompt = section.querySelector('.sign-in-to-comment-prompt');
            if (prompt) prompt.style.display = 'none';
        }
    });
}

        // Show/hide auth modal
        window.showAuthModal = function() {
            document.getElementById('auth-modal').style.display = 'flex';
            document.getElementById('error-message').classList.remove('show');
            // Reset to default view
            document.querySelectorAll('.email-auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.querySelector('.auth-options').style.display = 'flex';
        };

        window.closeAuthModal = function() {
            document.getElementById('auth-modal').style.display = 'none';
        };

        window.showEmailAuth = function(type) {
            document.querySelector('.auth-options').style.display = 'none';
            document.querySelectorAll('.email-auth-form').forEach(form => {
                form.classList.remove('active');
            });
            document.getElementById(`email-${type}-form`).classList.add('active');
        };

        // Handle Google sign in
        window.handleGoogleSignIn = async function() {
            try {
                await signInWithPopup(auth, googleProvider);
                closeAuthModal();
            } catch (error) {
                console.error('Error signing in with Google:', error);
                showError('Error signing in with Google. Please try again.');
            }
        };

        // Handle email sign up
        window.handleEmailSignUp = async function() {
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            
            if (!email || !password) {
                showError('Please enter both email and password.');
                return;
            }
            
            if (password.length < 6) {
                showError('Password must be at least 6 characters.');
                return;
            }
            
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                closeAuthModal();
            } catch (error) {
                console.error('Error signing up:', error);
                if (error.code === 'auth/email-already-in-use') {
                    showError('This email is already registered. Please sign in.');
                } else if (error.code === 'auth/invalid-email') {
                    showError('Invalid email address.');
                } else {
                    showError('Error creating account. Please try again.');
                }
            }
        };

        // Handle email sign in
        window.handleEmailSignIn = async function() {
            const email = document.getElementById('signin-email').value.trim();
            const password = document.getElementById('signin-password').value;
            
            if (!email || !password) {
                showError('Please enter both email and password.');
                return;
            }
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                closeAuthModal();
            } catch (error) {
                console.error('Error signing in:', error);
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    showError('Invalid email or password.');
                } else if (error.code === 'auth/invalid-email') {
                    showError('Invalid email address.');
                } else {
                    showError('Error signing in. Please try again.');
                }
            }
        };

        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.textContent = message;
            errorEl.classList.add('show');
        }

        // Handle sign out
        window.handleSignOut = async function() {
            try {
                await signOut(auth);
            } catch (error) {
                console.error('Error signing out:', error);
            }
        };

        // Show username creation modal
        function showUsernameModal() {
            const modal = document.getElementById('username-modal');
            modal.style.display = 'flex';
        }

        // Create username
        window.createUsername = async function() {
            const usernameInput = document.getElementById('username-input');
            const username = usernameInput.value.trim();
            
            if (!username) {
                alert('Please enter a username.');
                return;
            }
            
            if (username.length < 3 || username.length > 20) {
                alert('Username must be between 3 and 20 characters.');
                return;
            }
            
            if (!/^[a-zA-Z0-9_]+$/.test(username)) {
                alert('Username can only contain letters, numbers, and underscores.');
                return;
            }
            
            try {
                // Check if username is taken
                const usernamesRef = collection(db, 'usernames');
                const usernameDoc = await getDoc(doc(usernamesRef, username.toLowerCase()));
                
                if (usernameDoc.exists()) {
                    alert('Username is already taken. Please choose another.');
                    return;
                }
                
                // Create username
                await setDoc(doc(db, 'users', currentUser.uid), {
                    username: username,
                    createdAt: serverTimestamp()
                });
                
                await setDoc(doc(db, 'usernames', username.toLowerCase()), {
                    uid: currentUser.uid
                });
                
                currentUsername = username;
                document.getElementById('username-modal').style.display = 'none';
                updateAuthUI(true, username);
                
            } catch (error) {
                console.error('Error creating username:', error);
                alert('Error creating username. Please try again.');
            }
        };

        // Toggle comment section visibility
        window.toggleCommentSection = function(rightNumber) {
            const section = document.getElementById(`comment-section-${rightNumber}`);
            if (section.style.display === 'none' || !section.style.display) {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        };
        
        // Function to load comments for a specific right
        function loadComments(rightNumber) {
            const commentsContainer = document.getElementById(`comments-list-${rightNumber}`);
            const trigger = document.querySelector(`.comment-trigger[data-right="${rightNumber}"]`);
            
            const q = query(
                collection(db, `comments-right-${rightNumber}`),
                orderBy('timestamp', 'desc')
            );

            onSnapshot(q, (snapshot) => {
                // Count only top-level comments
                const allComments = [];
                snapshot.forEach((docSnapshot) => {
                    allComments.push({ id: docSnapshot.id, ...docSnapshot.data() });
                });
                
                const topLevelComments = allComments.filter(c => !c.parentId);
                const count = topLevelComments.length;
                commentCounts[rightNumber] = count;
                
                // Update trigger button
                if (trigger) {
                    const countEl = trigger.querySelector('.comment-count');
                    if (countEl) {
                        countEl.textContent = count;
                    }
                }
                
                commentsContainer.innerHTML = '';
                if (topLevelComments.length === 0) {
                    commentsContainer.innerHTML = '<p class="no-comments">No comments yet. Be the first to share your thoughts!</p>';
                    return;
                }
                
                // Render top-level comments
                topLevelComments.forEach((comment) => {
                    const commentEl = renderComment(comment, rightNumber, allComments);
                    commentsContainer.appendChild(commentEl);
                });
            });
        }

        // Function to render a single comment with replies
        function renderComment(comment, rightNumber, allComments) {
            const commentWrapper = document.createElement('div');
            commentWrapper.className = 'comment-wrapper';
            
            const commentEl = document.createElement('div');
            commentEl.className = 'comment';
            commentEl.setAttribute('data-comment-id', comment.id);
            
            const date = comment.timestamp?.toDate();
            const timeAgo = date ? getTimeAgo(date) : 'Just now';
            
            const canDelete = currentUser && comment.userId === currentUser.uid;
            const deleteButton = canDelete ? `<button class="delete-comment-btn" onclick="deleteComment('${rightNumber}', '${comment.id}')">Delete</button>` : '';
            
            const replyButton = currentUser ? `<button class="reply-button" onclick="showReplyForm('${rightNumber}', '${comment.id}', '${escapeHtml(comment.username)}')">Reply</button>` : '';
            
            commentEl.innerHTML = `
                <div class="comment-header">
                    <strong class="comment-author">${escapeHtml(comment.username)}</strong>
                    <div class="comment-meta">
                        <span class="comment-time">${timeAgo}</span>
                        ${replyButton}
                        ${deleteButton}
                    </div>
                </div>
                <p class="comment-text">${escapeHtml(comment.text)}</p>
                <div class="reply-form" id="reply-form-${comment.id}">
                    <div class="reply-to-indicator">Replying to <strong>@${escapeHtml(comment.username)}</strong></div>
                    <textarea class="comment-input" id="reply-text-${comment.id}" placeholder="Write your reply..." maxlength="500"></textarea>
                    <div>
                        <button class="comment-submit" onclick="submitReply('${rightNumber}', '${comment.id}')">Post Reply</button>
                        <button class="cancel-reply-btn" onclick="cancelReply('${comment.id}')">Cancel</button>
                    </div>
                </div>
            `;
            
            commentWrapper.appendChild(commentEl);
            
            // Get replies for this comment
            const replies = allComments.filter(c => c.parentId === comment.id);
            if (replies.length > 0) {
                const repliesContainer = document.createElement('div');
                repliesContainer.className = 'comment-replies';
                
                replies.forEach(reply => {
                    const replyEl = renderReply(reply, rightNumber);
                    repliesContainer.appendChild(replyEl);
                });
                
                commentWrapper.appendChild(repliesContainer);
            }
            
            return commentWrapper;
        }

        // Function to render a reply
        function renderReply(reply, rightNumber) {
            const replyEl = document.createElement('div');
            replyEl.className = 'comment reply';
            replyEl.setAttribute('data-comment-id', reply.id);
            
            const date = reply.timestamp?.toDate();
            const timeAgo = date ? getTimeAgo(date) : 'Just now';
            
            const canDelete = currentUser && reply.userId === currentUser.uid;
            const deleteButton = canDelete ? `<button class="delete-comment-btn" onclick="deleteComment('${rightNumber}', '${reply.id}')">Delete</button>` : '';
            
            replyEl.innerHTML = `
                <div class="comment-header">
                    <strong class="comment-author">${escapeHtml(reply.username)}</strong>
                    <div class="comment-meta">
                        <span class="comment-time">${timeAgo}</span>
                        ${deleteButton}
                    </div>
                </div>
                <p class="comment-text">${escapeHtml(reply.text)}</p>
            `;
            
            return replyEl;
        }

        // Show reply form
        window.showReplyForm = function(rightNumber, commentId, username) {
            if (!currentUser) {
                showAuthModal();
                return;
            }
            
            // Hide all other reply forms
            document.querySelectorAll('.reply-form').forEach(form => {
                form.classList.remove('active');
            });
            
            // Show this reply form
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            if (replyForm) {
                replyForm.classList.add('active');
                const textarea = document.getElementById(`reply-text-${commentId}`);
                if (textarea) textarea.focus();
            }
        };

        // Cancel reply
        window.cancelReply = function(commentId) {
            const replyForm = document.getElementById(`reply-form-${commentId}`);
            if (replyForm) {
                replyForm.classList.remove('active');
                const textarea = document.getElementById(`reply-text-${commentId}`);
                if (textarea) textarea.value = '';
            }
        };

        // Submit reply
        window.submitReply = async function(rightNumber, parentId) {
            if (!currentUser || !currentUsername) {
                showAuthModal();
                return;
            }
            
            const textInput = document.getElementById(`reply-text-${parentId}`);
            const text = textInput.value.trim();
            
            if (!text) {
                alert('Please enter a reply.');
                return;
            }
            
            if (text.length > 500) {
                alert('Reply is too long. Maximum 500 characters.');
                return;
            }
            
            try {
                await addDoc(collection(db, `comments-right-${rightNumber}`), {
                    username: currentUsername,
                    userId: currentUser.uid,
                    text: text,
                    parentId: parentId,
                    timestamp: serverTimestamp()
                });
                
                textInput.value = '';
                cancelReply(parentId);
            } catch (error) {
                console.error('Error adding reply:', error);
                alert('Error posting reply. Please try again.');
            }
        };

        // Function to submit a comment
        window.submitComment = async function(rightNumber) {
            if (!currentUser || !currentUsername) {
                showAuthModal();
                return;
            }
            
            const textInput = document.getElementById(`comment-text-${rightNumber}`);
            const submitBtn = document.getElementById(`comment-submit-${rightNumber}`);
            
            const text = textInput.value.trim();
            
            if (!text) {
                alert('Please enter a comment.');
                return;
            }
            
            if (text.length > 500) {
                alert('Comment is too long. Maximum 500 characters.');
                return;
            }
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Posting...';
            
            try {
                await addDoc(collection(db, `comments-right-${rightNumber}`), {
                    username: currentUsername,
                    userId: currentUser.uid,
                    text: text,
                    timestamp: serverTimestamp()
                });
                
                textInput.value = '';
                submitBtn.textContent = 'Posted!';
                setTimeout(() => {
                    submitBtn.textContent = 'Post Comment';
                    submitBtn.disabled = false;
                }, 2000);
            } catch (error) {
                console.error('Error adding comment:', error);
                alert('Error posting comment. Please try again.');
                submitBtn.textContent = 'Post Comment';
                submitBtn.disabled = false;
            }
        };

        // Function to delete a comment
        window.deleteComment = async function(rightNumber, commentId) {
            if (!confirm('Are you sure you want to delete this comment?')) {
                return;
            }
            
            try {
                await deleteDoc(doc(db, `comments-right-${rightNumber}`, commentId));
            } catch (error) {
                console.error('Error deleting comment:', error);
                alert('Error deleting comment. Please try again.');
            }
        };

        // Helper function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Helper function to get time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + ' year' + (Math.floor(interval) > 1 ? 's' : '') + ' ago';
            
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + ' month' + (Math.floor(interval) > 1 ? 's' : '') + ' ago';
            
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + ' day' + (Math.floor(interval) > 1 ? 's' : '') + ' ago';
            
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + ' hour' + (Math.floor(interval) > 1 ? 's' : '') + ' ago';
            
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + ' minute' + (Math.floor(interval) > 1 ? 's' : '') + ' ago';
            
            return 'Just now';
        }

        // Load comments for all rights when page loads
        document.addEventListener('DOMContentLoaded', () => {
            for (let i = 1; i <= 10; i++) {
                loadComments(i);
            }
            
            // Initialize click handlers for comment triggers (in case auth hasn't loaded yet)
            updateAuthUI(false);
        });
    </script>

    <script>
        // Animate cards on scroll
        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry, index) => {
                if (entry.isIntersecting) {
                    setTimeout(() => {
                        entry.target.classList.add('visible');
                    }, index * 100);
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.right-card').forEach(card => {
            observer.observe(card);
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
            const navLinks = document.querySelector('.nav-links');
            const navCta = document.querySelector('.nav-cta');
    
            if (navLinks.style.display === 'flex') {
                navLinks.style.display = 'none';
                if (navCta) navCta.style.display = 'none';
            } else {
                navLinks.style.display = 'flex';
                if (navCta) navCta.style.display = 'block';
            }
        });
    </script>
</body>
</html>

